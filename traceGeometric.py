#!/usr/bin/env python2.7import arcpy, os# Local variables:nWksp = "C:\\Temp\\test.gdb"Hydro_Net = nWksp+"\\Hydro\\Hydro_Net"DamPoints = nWksp+"\\Hydro\\DamPoints"GagePoints= nWksp+"\\Hydro\\GagePoints"GageReachcodeField = "GageReachcode"workspace = nWksparcpy.env.overwriteOutput = Truetry:    DamDesc = arcpy.Describe(DamPoints)    # add GageReachcodID field if not present    if GageReachcodeField not in arcpy.ListFields(DamPoints):        arcpy.AddField_management(DamPoints, "GageReachcode", "TEXT", "", "", "14", "", "NULLABLE", "NON_REQUIRED", "")    # Start an edit session. Must provide the worksapce.    edit = arcpy.da.Editor(workspace)            # Edit session is started without an undo/redo stack for versioned data      edit.startEditing(False, False)           # Start an edit operation      edit.startOperation()    with arcpy.da.UpdateCursor(DamPoints,['SHAPE@','Reachcode','GageReachcode']) as updCursor:          for updRow in updCursor:                        #damReachcode = str(getattr(updRow,"Reachcode"))            damReachcode = str(updRow[1])            print("\nCurrent dam ID : "+updRow[1])            print("Running traceGeometric ...") #testing            try:                # Process: Trace Geometric Network                newNet = r'in_memory\Hydro_Net2'                rowDamPoints=updRow[0]                arcpy.TraceGeometricNetwork_management(Hydro_Net, newNet, rowDamPoints, "TRACE_DOWNSTREAM", GagePoints, "", "", "", "", "TRACE_ENDS", "NO_TRACE_INDETERMINATE_FLOW", "", "", "AS_IS", "", "", "", "AS_IS")                print("Getting traceGeometric result ...") #testing                # Process: Select Data                SelectData_Result = arcpy.SelectData_management(newNet, "GagePoints")                gagePoints_SelectData = SelectData_Result.getOutput(0)                # make sure gagePoints were selected, if not skip below if                inDesc = arcpy.Describe(gagePoints_SelectData)                if inDesc.FIDSet <> "":                    gageReachcode = ""                    with arcpy.da.SearchCursor(gagePoints_SelectData,'Reachcode') as srcCursor:                        for srcRow in srcCursor:                            gageReachcode = gageReachcode + str(srcRow[0])                            print("closest gage found: "+srcRow[0])                    updRow[2] = str(gageReachcode)                else:                    print("closest gage wasn't found")                updCursor.updateRow(updRow)                # arcpy.Delete_Management(newNet) # Bill suggested this but it won't work with updateCursor (chieko)            except RuntimeError:                updCursor.updateRow(updRow)                print("traceGeometric caused an error") #testing                continue    del updCursor, updRow, srcCursor, srcRow, damReachcode, gageReachcode, newNet    print("\n... end of code") #testing    # Aborts the edit operation.      edit.abortOperation()      # Stop the edit session and save the changes      edit.stopEditing(True)    print ("Code worked and now it stopped editing..")except:    print("Script didn't run at all") #testing